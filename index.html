<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>QuickShop-Hikari // Paste Reader</title>
    <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css" type="text/css">
    <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js"></script>

</head>

<body style="max-width: 70em !important;">
    <main>
        <h1 id="title">Welcome to QuickShop-Hikari Paste Viewer</h1>
        <p id="description">Type <code>/qs paste</code> in game to create a paste.</p>
        <div id="extra-description"></div>
    </main>
    <script>
        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
        function failsGFWCheck(){
            $.ajax({
                url: "http://ip-api.com/json/?fields=status,countryCode",
                success: function (response, status, xhr) {
                    var country = response.countryCode;
                    if(country == "CN"){
                        // GFW blocks the CloudFlare Worker :( Show the error message
                        var content = "<blockquote><b>Sorry, this feature is not available in the current country or region</b><br />Your country or region may not be able to access our proxy servers hosted on CloudFlare.</blockquote>";
                        $("#extra-description").html(content);
                    }
                },
            });


        }
        if (getQueryString("remote")) {
            $("#title").text("Loading...");
            $("#description").text("Please wait... Paste viewer are retrieve the content from remote server...");

            $.ajax({
                url: "https://quickshop-proxy.ghostchu.workers.dev/?url="+getQueryString("remote"),
                success: function (response, status, xhr) {
                    document.write(response.data);
                    document.close();
                },
                error: function (xhr, status, error) {
                    var url = getQueryString("remote");
                    $("#title").text("Failed to load.");
                    $("#description").html("Viewer cannot fetch the context from <code>" + url + "</code>, press F5 to <a href=\"javascript:location.reload()\">reload</a> the page try again.<br />If still doesn't work, please contact Ghost_chu.");
                    failsGFWCheck();
                },
            });
        }
    </script>
</body>
<footer>
    <p>
           Built with <a href="https://github.com/oxalorg/sakura">Sakura.css</a>. <br />
           Pastebin providers: <a href="https://bytebin.lucko.me/">Lucko Bytebin </a>[<a href="https://github.com/sponsors/lucko">Support lucko</a>] <br />
           Made with sugar and cat paws &lt;3.
    </p>
</footer>
</html>
